<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Chat</title> 
 
<style>
    :root {
        --bg: #f5f5f5;
        --text: #111;
        --bubble-user: #cfe2ff;
        --bubble-bot: #e2e2e2;
        --header: #111;
        --header-text: #fff;
    }

    body.dark {
        --bg: #0d0d0d;
        --text: #eee;
        --bubble-user: #003366;
        --bubble-bot: #1e1e1e;
        --header: #222;
        --header-text: #fff;
    }

    body {
        background: var(--bg);
        font-family: Arial;
        margin: 0;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        color: var(--text);
        transition: 0.3s ease;
    }

    .chat-container {
        width: 450px;
        height: 620px;
        background: var(--bg);
        border-radius: 10px;
        box-shadow: 0 3px 20px rgba(0,0,0,0.2);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .header {
        background: var(--header);
        padding: 15px;
        color: var(--header-text);
        display: flex;
        justify-content: space-between;
        font-size: 20px;
        align-items: center;
    }

    .toggle-btn {
        background: none;
        border: 1px solid #fff;
        padding: 5px 12px;
        font-size: 12px;
        border-radius: 6px;
        cursor: pointer;
        color: white;
    }

    .messages {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
    }

    .message {
        padding: 12px 15px;
        margin-bottom: 12px;
        border-radius: 12px;
        max-width: 75%;
        line-height: 1.5;
        font-size: 15px;
        animation: fadeIn 0.25s ease;
        white-space: pre-wrap;
    }

    .user {
        background: var(--bubble-user);
        margin-left: auto;
    }

    .bot {
        background: var(--bubble-bot);
        margin-right: auto;
    }

    .typing-dots {
        width: 40px;
        height: 10px;
        display: flex;
        justify-content: space-between;
    }

    @keyframes blink {
        0%, 100% { opacity: 0.2 }
        50% { opacity: 1 }
    }

    .dot {
        width: 8px;
        height: 8px;
        background: gray;
        border-radius: 50%;
        animation: blink 1s infinite;
    }
    .dot:nth-child(2) { animation-delay: 0.2s; }
    .dot:nth-child(3) { animation-delay: 0.4s; }

    .input-area {
        display: flex;
        border-top: 1px solid #ddd;
    }

    input {
        flex: 1;
        padding: 12px;
        border: none;
        outline: none;
        background: var(--bg);
        color: var(--text);
        font-size: 15px;
    }

    button {
        padding: 12px 20px;
        border: none;
        background: var(--header);
        color: white;
        cursor: pointer;
    }
</style>
</head>
<body>

<div class="chat-container">
    <div class="header">
        AI Chat
        <button class="toggle-btn" onclick="toggleDark()">Dark Mode</button>
    </div>

    <div class="messages" id="messages"></div>

    <div class="input-area">
        <input id="userInput" placeholder="Type a message...">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
const API_KEY = "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";
const API_URL = "https://openrouter.ai/api/v1/chat/completions";

let messagesDiv = document.getElementById("messages");

// Load chat history
window.onload = () => {
    let old = localStorage.getItem("chat_history");
    if (old) messagesDiv.innerHTML = old;
    scrollToBottom();
};

function saveChat() {
    localStorage.setItem("chat_history", messagesDiv.innerHTML);
}

function toggleDark() {
    document.body.classList.toggle("dark");
}

document.getElementById("userInput").addEventListener("keypress", (e) => {
    if (e.key === "Enter") sendMessage();
});

function addMessage(text, sender) {
    const msg = document.createElement("div");
    msg.classList.add("message", sender);
    msg.innerHTML = text;
    messagesDiv.appendChild(msg);
    saveChat();
    scrollToBottom();
}

function addTyping() {
    const box = document.createElement("div");
    box.classList.add("message", "bot", "typing");
    box.innerHTML = `
        <div class="typing-dots">
            <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>`;
    messagesDiv.appendChild(box);
    scrollToBottom();
}

function removeTyping() {
    let typing = document.querySelector(".typing");
    if (typing) typing.remove();
}

function scrollToBottom() {
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

async function sendMessage() {
    let input = document.getElementById("userInput");
    let text = input.value.trim();
    if (!text) return;
    input.value = "";

    addMessage(text, "user");
    addTyping();

    try {
        const res = await fetch(API_URL, {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${API_KEY}`,
                "Content-Type": "application/json",
                "HTTP-Referer": "http://localhost",
                "X-Title": "AI Chat"
            },
            body: JSON.stringify({
                model: "openai/gpt-4o-mini",
                messages: [{ role: "user", content: text }]
            })
        });

        const data = await res.json();
        removeTyping();

        let reply = data.choices?.[0]?.message?.content || "No response";
        addMessage(reply, "bot");

    } catch {
        removeTyping();
        addMessage("⚠️ Error connecting to server", "bot");
    }
}
</script>
</body>
</html>
